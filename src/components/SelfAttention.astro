---
// 自注意力机制可视化
---
<div class="svg-container">
    <svg width="600" height="280" viewBox="0 0 600 280" xmlns="http://www.w3.org/2000/svg">
        <defs>
            <marker id="arrow-attn" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
                <polygon points="0 0, 8 3, 0 6" fill="#3b82f6"/>
            </marker>
        </defs>

        <!-- Title -->
        <text x="300" y="25" text-anchor="middle" font-size="16" font-weight="bold" fill="#1e293b">Self-Attention 机制</text>

        <!-- Input sequence -->
        <g transform="translate(50, 60)">
            <text x="0" y="0" font-size="12" fill="#64748b">输入序列:</text>
            <rect x="0" y="15" width="60" height="35" rx="4" fill="#bfdbfe" stroke="#2563eb"/>
            <text x="30" y="38" text-anchor="middle" font-size="11">"我"</text>
            <rect x="70" y="15" width="60" height="35" rx="4" fill="#bfdbfe" stroke="#2563eb"/>
            <text x="100" y="38" text-anchor="middle" font-size="11">"喜欢"</text>
            <rect x="140" y="15" width="60" height="35" rx="4" fill="#fca5a5" stroke="#dc2626" stroke-width="2"/>
            <text x="170" y="38" text-anchor="middle" font-size="11">"苹果"</text>
            <rect x="210" y="15" width="60" height="35" rx="4" fill="#bfdbfe" stroke="#2563eb"/>
            <text x="240" y="38" text-anchor="middle" font-size="11">"公司"</text>
        </g>

        <!-- Q K V -->
        <g transform="translate(350, 60)">
            <rect x="0" y="0" width="60" height="50" rx="4" fill="#fef3c7" stroke="#d97706"/>
            <text x="30" y="20" text-anchor="middle" font-size="12" font-weight="bold" fill="#92400e">Query</text>
            <text x="30" y="38" text-anchor="middle" font-size="9" fill="#92400e">(查询)</text>

            <rect x="70" y="0" width="60" height="50" rx="4" fill="#dcfce7" stroke="#22c55e"/>
            <text x="100" y="20" text-anchor="middle" font-size="12" font-weight="bold" fill="#166534">Key</text>
            <text x="100" y="38" text-anchor="middle" font-size="9" fill="#166534">(键)</text>

            <rect x="140" y="0" width="60" height="50" rx="4" fill="#e0e7ff" stroke="#6366f1"/>
            <text x="170" y="20" text-anchor="middle" font-size="12" font-weight="bold" fill="#4338ca">Value</text>
            <text x="170" y="38" text-anchor="middle" font-size="9" fill="#4338ca">(值)</text>
        </g>

        <!-- Attention weights visualization -->
        <g transform="translate(50, 150)">
            <text x="0" y="0" font-size="12" fill="#64748b">注意力权重 (对于 "苹果"):</text>

            <!-- Bars -->
            <rect x="0" y="15" width="40" height="25" rx="3" fill="#93c5fd"/>
            <text x="20" y="32" text-anchor="middle" font-size="10">0.1</text>
            <text x="20" y="55" text-anchor="middle" font-size="9" fill="#64748b">"我"</text>

            <rect x="60" y="15" width="50" height="25" rx="3" fill="#60a5fa"/>
            <text x="85" y="32" text-anchor="middle" font-size="10">0.15</text>
            <text x="85" y="55" text-anchor="middle" font-size="9" fill="#64748b">"喜欢"</text>

            <rect x="130" y="15" width="80" height="25" rx="3" fill="#dc2626"/>
            <text x="170" y="32" text-anchor="middle" font-size="10" fill="white">0.35</text>
            <text x="170" y="55" text-anchor="middle" font-size="9" fill="#64748b">"苹果"</text>

            <rect x="230" y="15" width="90" height="25" rx="3" fill="#2563eb"/>
            <text x="275" y="32" text-anchor="middle" font-size="10" fill="white">0.4</text>
            <text x="275" y="55" text-anchor="middle" font-size="9" fill="#64748b">"公司"</text>
        </g>

        <!-- Formula -->
        <g transform="translate(350, 150)">
            <rect x="0" y="0" width="200" height="80" rx="8" fill="#f8fafc" stroke="#e2e8f0"/>
            <text x="100" y="25" text-anchor="middle" font-size="11" font-weight="bold" fill="#334155">注意力公式:</text>
            <text x="100" y="50" text-anchor="middle" font-size="11" font-family="serif" fill="#475569">Attention(Q,K,V) =</text>
            <text x="100" y="70" text-anchor="middle" font-size="11" font-family="serif" fill="#475569">softmax(QKᵀ/√d) · V</text>
        </g>

        <!-- Bottom explanation -->
        <text x="300" y="260" text-anchor="middle" font-size="11" fill="#64748b">
            "苹果" 关注 "公司" 最多 → 模型理解这里是 Apple Inc. 而非水果
        </text>
    </svg>
</div>
