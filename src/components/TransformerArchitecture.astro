---
// Transformer 架构图
---
<div class="svg-container bg-white border border-gray-200 shadow-inner">
    <svg width="700" height="500" viewBox="0 0 700 500" xmlns="http://www.w3.org/2000/svg">
        <defs>
            <marker id="arrow-tf" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
            </marker>
        </defs>

        <!-- Title -->
        <text x="350" y="30" text-anchor="middle" font-size="18" font-weight="bold" fill="#1e293b">Transformer 架构</text>

        <!-- Left: Encoder -->
        <g transform="translate(100, 60)">
            <rect x="0" y="0" width="180" height="380" rx="10" fill="#dbeafe" stroke="#2563eb" stroke-width="2"/>
            <text x="90" y="30" text-anchor="middle" font-weight="bold" font-size="14" fill="#1e40af">Encoder (N×)</text>

            <!-- Input Embedding -->
            <rect x="30" y="320" width="120" height="30" rx="4" fill="#fff" stroke="#94a3b8"/>
            <text x="90" y="340" text-anchor="middle" font-size="10">Input Embedding</text>

            <!-- Positional Encoding -->
            <circle cx="90" cy="290" r="15" fill="#fbbf24" stroke="#d97706"/>
            <text x="90" y="295" text-anchor="middle" font-size="10" fill="#92400e">+</text>
            <text x="130" y="295" font-size="9" fill="#666">Pos Enc</text>

            <!-- Multi-Head Attention -->
            <rect x="20" y="180" width="140" height="50" rx="4" fill="#fff" stroke="#94a3b8"/>
            <text x="90" y="200" text-anchor="middle" font-size="10" font-weight="bold">Multi-Head</text>
            <text x="90" y="215" text-anchor="middle" font-size="10" font-weight="bold">Attention</text>

            <!-- Add & Norm -->
            <rect x="20" y="145" width="140" height="25" rx="4" fill="#e0f2fe" stroke="#0ea5e9"/>
            <text x="90" y="162" text-anchor="middle" font-size="9">Add & Norm</text>

            <!-- Feed Forward -->
            <rect x="20" y="80" width="140" height="40" rx="4" fill="#fff" stroke="#94a3b8"/>
            <text x="90" y="105" text-anchor="middle" font-size="10" font-weight="bold">Feed Forward</text>

            <!-- Add & Norm -->
            <rect x="20" y="50" width="140" height="20" rx="4" fill="#e0f2fe" stroke="#0ea5e9"/>
            <text x="90" y="64" text-anchor="middle" font-size="9">Add & Norm</text>

            <!-- Arrows -->
            <path d="M90 320 L90 305" stroke="#666" stroke-width="1.5" marker-end="url(#arrow-tf)"/>
            <path d="M90 275 L90 235" stroke="#666" stroke-width="1.5" marker-end="url(#arrow-tf)"/>
            <path d="M90 180 L90 175" stroke="#666" stroke-width="1.5" marker-end="url(#arrow-tf)"/>
            <path d="M90 145 L90 125" stroke="#666" stroke-width="1.5" marker-end="url(#arrow-tf)"/>
            <path d="M90 80 L90 75" stroke="#666" stroke-width="1.5" marker-end="url(#arrow-tf)"/>
        </g>

        <!-- Right: Decoder -->
        <g transform="translate(420, 60)">
            <rect x="0" y="0" width="180" height="380" rx="10" fill="#fef3c7" stroke="#d97706" stroke-width="2"/>
            <text x="90" y="30" text-anchor="middle" font-weight="bold" font-size="14" fill="#92400e">Decoder (N×)</text>

            <!-- Output Embedding -->
            <rect x="30" y="320" width="120" height="30" rx="4" fill="#fff" stroke="#94a3b8"/>
            <text x="90" y="340" text-anchor="middle" font-size="10">Output Embedding</text>

            <!-- Positional Encoding -->
            <circle cx="90" cy="290" r="15" fill="#fbbf24" stroke="#d97706"/>
            <text x="90" y="295" text-anchor="middle" font-size="10" fill="#92400e">+</text>

            <!-- Masked Multi-Head Attention -->
            <rect x="20" y="230" width="140" height="40" rx="4" fill="#fff" stroke="#94a3b8"/>
            <text x="90" y="248" text-anchor="middle" font-size="9" font-weight="bold">Masked Multi-Head</text>
            <text x="90" y="260" text-anchor="middle" font-size="9" font-weight="bold">Attention</text>

            <!-- Add & Norm -->
            <rect x="20" y="200" width="140" height="20" rx="4" fill="#fef9c3" stroke="#eab308"/>
            <text x="90" y="214" text-anchor="middle" font-size="9">Add & Norm</text>

            <!-- Cross Attention -->
            <rect x="20" y="140" width="140" height="45" rx="4" fill="#dcfce7" stroke="#22c55e"/>
            <text x="90" y="158" text-anchor="middle" font-size="9" font-weight="bold">Cross-Attention</text>
            <text x="90" y="172" text-anchor="middle" font-size="8">(K, V from Encoder)</text>

            <!-- Add & Norm -->
            <rect x="20" y="110" width="140" height="20" rx="4" fill="#fef9c3" stroke="#eab308"/>
            <text x="90" y="124" text-anchor="middle" font-size="9">Add & Norm</text>

            <!-- Feed Forward -->
            <rect x="20" y="70" width="140" height="30" rx="4" fill="#fff" stroke="#94a3b8"/>
            <text x="90" y="90" text-anchor="middle" font-size="10" font-weight="bold">Feed Forward</text>

            <!-- Add & Norm -->
            <rect x="20" y="45" width="140" height="18" rx="4" fill="#fef9c3" stroke="#eab308"/>
            <text x="90" y="58" text-anchor="middle" font-size="9">Add & Norm</text>
        </g>

        <!-- Cross connection -->
        <path d="M280 150 L420 200" stroke="#22c55e" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#arrow-tf)"/>
        <text x="350" y="165" text-anchor="middle" font-size="10" fill="#22c55e">K, V</text>

        <!-- Output -->
        <g transform="translate(420, 450)">
            <rect x="30" y="0" width="120" height="30" rx="4" fill="#f3e8ff" stroke="#9333ea" stroke-width="2"/>
            <text x="90" y="20" text-anchor="middle" font-size="10" font-weight="bold" fill="#6b21a8">Output Probs</text>
        </g>
        <path d="M510 60 L510 450" stroke="#666" stroke-width="1.5" marker-end="url(#arrow-tf)"/>

        <!-- Input labels -->
        <text x="190" y="470" text-anchor="middle" font-size="11" fill="#666">Inputs</text>
        <text x="510" y="490" text-anchor="middle" font-size="11" fill="#666">Outputs (shifted right)</text>
    </svg>
</div>
