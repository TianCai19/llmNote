---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { todayYmd } from '../../utils/date';

const createdAt = todayYmd();
---

<BaseLayout title="Agent-as-a-Judge：用代理评估代理">
    <header class="text-center mb-12">
        <p class="text-xs uppercase tracking-[0.3em] text-[color:var(--muted)]">Evaluation / Agents</p>
        <h1 class="text-4xl font-bold mb-4 gradient-text">Agent-as-a-Judge：用代理评估代理</h1>
        <p class="text-xl text-gray-500">把“评测”变成可扩展的过程反馈系统，而不是终点打分</p>
        <p class="mt-4 text-sm uppercase tracking-[0.2em] text-[color:var(--muted)]">添加时间 {createdAt}</p>
    </header>

    <div class="card">
        <h2>一句话理解</h2>
        <p>Agent-as-a-Judge 的核心是：<span class="highlight">让一个能看懂项目与轨迹的代理来评测另一个代理</span>，并且对每条需求给出证据与判定，而不是只看最终输出。</p>
        <p>它延伸自 LLM-as-a-Judge，但加上了“代理能力”（文件定位、检索、跨模态阅读、计划执行），因此能提供过程级反馈。</p>
        <div class="note-box text-sm mt-4">
            <p><strong>原文摘录：</strong></p>
            <p class="text-sm text-gray-600 italic">“We introduce the Agent-as-a-Judge framework, wherein agentic systems are used to evaluate agentic systems.”</p>
            <p class="text-xs text-gray-500 mt-2">来源：<a href="https://arxiv.org/html/2410.10934v2" class="text-[color:var(--accent)] underline">arXiv:2410.10934v2</a> Abstract</p>
        </div>
        <div class="note-box text-sm mt-4">
            <p><strong>直观类比：</strong>传统评测像“期末考试”；Agent-as-a-Judge 更像“老师跟进作业过程、逐条反馈”。</p>
        </div>
    </div>

    <div class="card">
        <h2>为什么传统评测不够用</h2>
        <p>代理系统会长链路执行任务，产出代码、配置、数据、报告与中间结果。只看最终结果会错过过程问题，也难以定位瓶颈。</p>
        <div class="grid grid-cols-1 gap-6 md:grid-cols-3">
            <div class="rounded-2xl border border-white/70 bg-white/80 p-4">
                <h3 class="text-lg font-semibold text-slate-700">只看终点</h3>
                <p class="text-sm text-gray-600">Pass@1 或整体完成率无法告诉你问题卡在哪一步。</p>
            </div>
            <div class="rounded-2xl border border-white/70 bg-white/80 p-4">
                <h3 class="text-lg font-semibold text-slate-700">人力昂贵</h3>
                <p class="text-sm text-gray-600">多步骤开发任务需要专家逐条评估，成本不可扩展。</p>
            </div>
            <div class="rounded-2xl border border-white/70 bg-white/80 p-4">
                <h3 class="text-lg font-semibold text-slate-700">缺少过程信号</h3>
                <p class="text-sm text-gray-600">没有中间反馈，难以做过程监督与自我改进。</p>
            </div>
        </div>
        <figure class="mt-6 bg-white/70 border border-white/70 rounded-2xl p-4">
            <svg viewBox="0 0 860 240" role="img" aria-label="Outcome vs process evaluation" class="w-full">
                <rect x="24" y="24" width="812" height="192" rx="18" fill="#f8fafc" stroke="#e2e8f0" />
                <text x="60" y="58" font-size="12" fill="#64748b">传统：只看终点</text>
                <text x="480" y="58" font-size="12" fill="#64748b">Agent-as-a-Judge：看过程 + 证据</text>

                <circle cx="110" cy="120" r="18" fill="#e2e8f0" />
                <circle cx="180" cy="120" r="18" fill="#e2e8f0" />
                <circle cx="250" cy="120" r="18" fill="#e2e8f0" />
                <circle cx="320" cy="120" r="18" fill="#34d399" />
                <line x1="128" y1="120" x2="162" y2="120" stroke="#cbd5f5" stroke-width="3" />
                <line x1="198" y1="120" x2="232" y2="120" stroke="#cbd5f5" stroke-width="3" />
                <line x1="268" y1="120" x2="302" y2="120" stroke="#cbd5f5" stroke-width="3" />
                <text x="60" y="170" font-size="11" fill="#94a3b8">只判最终圆点是否成功</text>

                <rect x="470" y="95" width="70" height="40" rx="10" fill="#e0f2fe" stroke="#bae6fd" />
                <rect x="560" y="95" width="70" height="40" rx="10" fill="#e0f2fe" stroke="#bae6fd" />
                <rect x="650" y="95" width="70" height="40" rx="10" fill="#e0f2fe" stroke="#bae6fd" />
                <rect x="740" y="95" width="70" height="40" rx="10" fill="#34d399" stroke="#86efac" />
                <line x1="540" y1="115" x2="560" y2="115" stroke="#94a3b8" stroke-width="2" />
                <line x1="630" y1="115" x2="650" y2="115" stroke="#94a3b8" stroke-width="2" />
                <line x1="720" y1="115" x2="740" y2="115" stroke="#94a3b8" stroke-width="2" />
                <text x="480" y="170" font-size="11" fill="#94a3b8">逐步评估，每步都有证据</text>
            </svg>
            <figcaption class="text-sm text-gray-500 mt-3">从“终点判分”升级为“过程可追踪、可反馈”。</figcaption>
        </figure>
    </div>

    <div class="card">
        <h2>DevAI：真实 AI 开发任务基准</h2>
        <p>论文发布 DevAI 数据集：<span class="highlight">55 个完整 AI 开发任务、365 条分层需求</span>。这些需求像真实开发 checklist，覆盖数据处理、训练、评估与报告。</p>
        <div class="note-box text-sm mt-4">
            <p><strong>原文摘录：</strong></p>
            <p class="text-sm text-gray-600 italic">“we present DevAI, a new benchmark of 55 realistic automated AI development tasks. It includes rich manual annotations, like a total of 365 hierarchical user requirements.”</p>
            <p class="text-xs text-gray-500 mt-2">来源：<a href="https://arxiv.org/html/2410.10934v2" class="text-[color:var(--accent)] underline">arXiv:2410.10934v2</a> Abstract</p>
        </div>
        <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
            <div>
                <ul class="list-disc pl-6">
                    <li>任务描述贴近真实用户需求，不是单一算法题。</li>
                    <li>每条需求可独立验证，支持依赖关系。</li>
                    <li>更容易定位：模型在哪一步失分。</li>
                </ul>
            </div>
            <div class="rounded-2xl border border-white/70 bg-white/80 p-4 text-sm text-gray-600">
                <p><strong>示例需求结构：</strong></p>
                <p class="mt-2">R0: 按指定论文实现数据处理脚本</p>
                <p>R1: 输出 1080p 结果图并保存到 results/</p>
                <p>R2: 生成控制样例并人工验证</p>
                <p class="mt-3 text-xs">需求带依赖：R1 -> R0，R2 -> R1</p>
            </div>
        </div>
        <figure class="mt-6 bg-white/70 border border-white/70 rounded-2xl p-4">
            <svg viewBox="0 0 860 260" role="img" aria-label="DevAI requirement graph" class="w-full">
                <rect x="24" y="24" width="812" height="212" rx="18" fill="#f8fafc" stroke="#e2e8f0" />
                <text x="50" y="58" font-size="12" fill="#64748b">用户任务描述</text>
                <rect x="50" y="70" width="230" height="60" rx="12" fill="#e0f2fe" stroke="#bae6fd" />
                <text x="165" y="105" text-anchor="middle" font-size="12" fill="#0f172a">Query: 完整 AI 流程</text>

                <text x="330" y="58" font-size="12" fill="#64748b">分层需求</text>
                <rect x="310" y="70" width="150" height="44" rx="10" fill="#dcfce7" stroke="#86efac" />
                <rect x="480" y="70" width="150" height="44" rx="10" fill="#dcfce7" stroke="#86efac" />
                <rect x="650" y="70" width="150" height="44" rx="10" fill="#dcfce7" stroke="#86efac" />
                <text x="385" y="98" text-anchor="middle" font-size="12" fill="#14532d">R0 数据</text>
                <text x="555" y="98" text-anchor="middle" font-size="12" fill="#14532d">R1 训练</text>
                <text x="725" y="98" text-anchor="middle" font-size="12" fill="#14532d">R2 报告</text>

                <line x1="280" y1="100" x2="310" y2="92" stroke="#94a3b8" stroke-width="1.5" />
                <line x1="280" y1="100" x2="310" y2="114" stroke="#94a3b8" stroke-width="1.5" />
                <line x1="460" y1="92" x2="480" y2="92" stroke="#94a3b8" stroke-width="1.5" />
                <line x1="630" y1="92" x2="650" y2="92" stroke="#94a3b8" stroke-width="1.5" />

                <text x="330" y="162" font-size="12" fill="#64748b">证据与判定</text>
                <rect x="310" y="170" width="190" height="44" rx="10" fill="#fee2e2" stroke="#fecaca" />
                <rect x="520" y="170" width="190" height="44" rx="10" fill="#fee2e2" stroke="#fecaca" />
                <text x="405" y="198" text-anchor="middle" font-size="12" fill="#7f1d1d">证据抓取</text>
                <text x="615" y="198" text-anchor="middle" font-size="12" fill="#7f1d1d">需求级判定</text>
            </svg>
            <figcaption class="text-sm text-gray-500 mt-3">DevAI 用“需求图”刻画开发过程，使评测更可解释。</figcaption>
        </figure>
    </div>

    <div class="card">
        <h2>Agent-as-a-Judge 架构：模块化评测代理</h2>
        <p>评测代理不是单一模型，而是多模块协作系统。核心是“定位证据 + 判定需求”的闭环。</p>
        <figure class="mt-6 bg-white/70 border border-white/70 rounded-2xl p-4">
            <svg viewBox="0 0 900 280" role="img" aria-label="Agent-as-a-Judge modules" class="w-full">
                <rect x="24" y="24" width="852" height="232" rx="18" fill="#f8fafc" stroke="#e2e8f0" />

                <rect x="50" y="70" width="140" height="44" rx="10" fill="#e0f2fe" stroke="#bae6fd" />
                <rect x="220" y="70" width="140" height="44" rx="10" fill="#e0f2fe" stroke="#bae6fd" />
                <rect x="390" y="70" width="140" height="44" rx="10" fill="#e0f2fe" stroke="#bae6fd" />
                <rect x="560" y="70" width="140" height="44" rx="10" fill="#e0f2fe" stroke="#bae6fd" />

                <text x="120" y="98" text-anchor="middle" font-size="12" fill="#0f172a">graph</text>
                <text x="290" y="98" text-anchor="middle" font-size="12" fill="#0f172a">locate</text>
                <text x="460" y="98" text-anchor="middle" font-size="12" fill="#0f172a">read</text>
                <text x="630" y="98" text-anchor="middle" font-size="12" fill="#0f172a">search</text>

                <rect x="135" y="160" width="140" height="44" rx="10" fill="#dcfce7" stroke="#86efac" />
                <rect x="305" y="160" width="140" height="44" rx="10" fill="#dcfce7" stroke="#86efac" />
                <rect x="475" y="160" width="140" height="44" rx="10" fill="#dcfce7" stroke="#86efac" />
                <rect x="645" y="160" width="140" height="44" rx="10" fill="#dcfce7" stroke="#86efac" />

                <text x="205" y="188" text-anchor="middle" font-size="12" fill="#14532d">retrieve</text>
                <text x="375" y="188" text-anchor="middle" font-size="12" fill="#14532d">ask</text>
                <text x="545" y="188" text-anchor="middle" font-size="12" fill="#14532d">memory</text>
                <text x="715" y="188" text-anchor="middle" font-size="12" fill="#14532d">planning</text>

                <line x1="190" y1="92" x2="220" y2="92" stroke="#94a3b8" stroke-width="1.5" />
                <line x1="360" y1="92" x2="390" y2="92" stroke="#94a3b8" stroke-width="1.5" />
                <line x1="530" y1="92" x2="560" y2="92" stroke="#94a3b8" stroke-width="1.5" />

                <line x1="290" y1="114" x2="205" y2="160" stroke="#cbd5f5" stroke-width="1.5" />
                <line x1="460" y1="114" x2="375" y2="160" stroke="#cbd5f5" stroke-width="1.5" />
                <line x1="630" y1="114" x2="545" y2="160" stroke="#cbd5f5" stroke-width="1.5" />
                <line x1="700" y1="114" x2="715" y2="160" stroke="#cbd5f5" stroke-width="1.5" />
            </svg>
            <figcaption class="text-sm text-gray-500 mt-3">模块化设计强调证据检索与需求判定的协作闭环。</figcaption>
        </figure>
        <div class="note-box text-sm mt-4">
            <p><strong>模块直觉：</strong>graph/locate/reading 负责“找到并看懂”，ask/decision 负责“对需求给结论”，planning 负责“下一步该查哪里”。</p>
        </div>
    </div>

    <div class="card">
        <h2>评测流程：从轨迹到需求判定</h2>
        <p>Agent-as-a-Judge 不是只看最终输出，而是走完整流程：</p>
        <ol class="list-decimal pl-6">
            <li>构建项目结构图，定位需求相关文件与产物。</li>
            <li>读取多模态证据：代码、配置、数据、报告、图片、日志。</li>
            <li>逐条需求判定，并附带证据引用。</li>
            <li>聚合为任务完成度与整体评测指标。</li>
        </ol>
        <figure class="mt-6 bg-white/70 border border-white/70 rounded-2xl p-4">
            <svg viewBox="0 0 860 250" role="img" aria-label="Evaluation pipeline" class="w-full">
                <rect x="24" y="24" width="812" height="202" rx="18" fill="#f8fafc" stroke="#e2e8f0" />
                <rect x="60" y="90" width="150" height="50" rx="12" fill="#e0f2fe" stroke="#bae6fd" />
                <rect x="245" y="90" width="150" height="50" rx="12" fill="#e0f2fe" stroke="#bae6fd" />
                <rect x="430" y="90" width="150" height="50" rx="12" fill="#e0f2fe" stroke="#bae6fd" />
                <rect x="615" y="90" width="150" height="50" rx="12" fill="#34d399" stroke="#86efac" />
                <text x="135" y="120" text-anchor="middle" font-size="12" fill="#0f172a">定位文件</text>
                <text x="320" y="120" text-anchor="middle" font-size="12" fill="#0f172a">读取证据</text>
                <text x="505" y="120" text-anchor="middle" font-size="12" fill="#0f172a">需求判定</text>
                <text x="690" y="120" text-anchor="middle" font-size="12" fill="#14532d">聚合评分</text>
                <line x1="210" y1="115" x2="245" y2="115" stroke="#94a3b8" stroke-width="2" />
                <line x1="395" y1="115" x2="430" y2="115" stroke="#94a3b8" stroke-width="2" />
                <line x1="580" y1="115" x2="615" y2="115" stroke="#94a3b8" stroke-width="2" />
            </svg>
            <figcaption class="text-sm text-gray-500 mt-3">流程化评测让每条需求可追溯、可复查。</figcaption>
        </figure>
        <div class="note-box text-sm mt-4">
            <p><strong>灰盒 vs 黑盒：</strong>灰盒能访问项目与轨迹，显著提高对齐率；黑盒只看最终输出更容易误判。</p>
        </div>
    </div>

    <div class="card">
        <h2>评测指标：对齐率与偏移</h2>
        <p>Agent-as-a-Judge 关注与人类共识的接近程度。常用指标：</p>
        <div class="math-block" set:html={String.raw`$$\text{Alignment Rate} = \frac{1}{N}\sum_{i=1}^{N} \mathbb{1}[J_i = H_i]$$`}></div>
        <p class="text-sm text-gray-600 mt-3">对齐率：判定结果与人类共识一致的比例，越高越好。</p>
        <div class="math-block" set:html={String.raw`$$\text{Judge Shift} = \frac{1}{N}\sum_{i=1}^{N} |J_i - H_i|$$`}></div>
        <p class="text-sm text-gray-600 mt-3">偏移度：评测偏离人类共识的程度，越低越好。</p>
        <figure class="mt-6 bg-white/70 border border-white/70 rounded-2xl p-4">
            <svg viewBox="0 0 860 260" role="img" aria-label="Alignment comparison" class="w-full">
                <rect x="24" y="24" width="812" height="212" rx="18" fill="#f8fafc" stroke="#e2e8f0" />
                <text x="60" y="58" font-size="12" fill="#64748b">对齐率示意</text>
                <rect x="80" y="170" width="120" height="30" rx="8" fill="#e2e8f0" />
                <rect x="80" y="130" width="120" height="70" rx="8" fill="#94a3b8" />
                <text x="140" y="215" text-anchor="middle" font-size="11" fill="#64748b">LLM-as-a-Judge</text>

                <rect x="260" y="150" width="120" height="50" rx="8" fill="#e2e8f0" />
                <rect x="260" y="100" width="120" height="100" rx="8" fill="#34d399" />
                <text x="320" y="215" text-anchor="middle" font-size="11" fill="#64748b">Agent-as-a-Judge</text>

                <rect x="440" y="120" width="120" height="80" rx="8" fill="#e2e8f0" />
                <rect x="440" y="90" width="120" height="110" rx="8" fill="#22c55e" />
                <text x="500" y="215" text-anchor="middle" font-size="11" fill="#64748b">Human Ensemble</text>

                <text x="640" y="110" font-size="12" fill="#64748b">趋势：Agent-as-a-Judge 接近人类共识</text>
            </svg>
            <figcaption class="text-sm text-gray-500 mt-3">论文显示 Agent-as-a-Judge 与人类共识对齐率约 90%+，显著高于 LLM-as-a-Judge。</figcaption>
        </figure>
    </div>

    <div class="card">
        <h2>实验结果：效果与成本</h2>
        <ul class="list-disc pl-6">
            <li>GPT-Pilot 与 OpenHands 平均只满足约 29% 的需求，完整完成任务很少。</li>
            <li>Agent-as-a-Judge 与人类共识对齐率约 90%+，LLM-as-a-Judge 约 70%。</li>
            <li>成本与时间：人类评测约 86.5 小时 / 1297 美元；Agent-as-a-Judge 约 118 分钟 / 30 美元。</li>
        </ul>
        <div class="note-box text-sm mt-4">
            <p><strong>原文摘录：</strong></p>
            <p class="text-sm text-gray-600 italic">“Agent-as-a-Judge aligns more closely with the consensus of our human judges (90%) as compared to LLM-as-a-Judge (70%).”</p>
            <p class="text-xs text-gray-500 mt-2">来源：<a href="https://arxiv.org/html/2410.10934v2" class="text-[color:var(--accent)] underline">arXiv:2410.10934v2</a> Introduction</p>
        </div>
        <figure class="mt-6 bg-white/70 border border-white/70 rounded-2xl p-4">
            <svg viewBox="0 0 860 260" role="img" aria-label="Cost comparison" class="w-full">
                <rect x="24" y="24" width="812" height="212" rx="18" fill="#f8fafc" stroke="#e2e8f0" />
                <text x="60" y="58" font-size="12" fill="#64748b">时间与成本对比（越短越好）</text>

                <text x="70" y="110" font-size="12" fill="#64748b">Human</text>
                <rect x="130" y="92" width="420" height="24" rx="6" fill="#fca5a5" />
                <text x="560" y="110" font-size="11" fill="#64748b">86.5h / $1297</text>

                <text x="70" y="150" font-size="12" fill="#64748b">LLM Judge</text>
                <rect x="130" y="132" width="140" height="24" rx="6" fill="#fdba74" />
                <text x="280" y="150" font-size="11" fill="#64748b">10.99m / $29.6</text>

                <text x="70" y="190" font-size="12" fill="#64748b">Agent Judge</text>
                <rect x="130" y="172" width="170" height="24" rx="6" fill="#34d399" />
                <text x="310" y="190" font-size="11" fill="#64748b">118m / $30.6</text>
            </svg>
            <figcaption class="text-sm text-gray-500 mt-3">Agent-as-a-Judge 在成本和对齐率之间取得更优折中。</figcaption>
        </figure>
    </div>

    <div class="card">
        <h2>为什么它更“像人类评测”</h2>
        <p>人类评测通常会做三件事：理解需求、查找证据、给出判定。Agent-as-a-Judge 的模块化架构正是对这一过程的工程化复刻。</p>
        <div class="grid grid-cols-1 gap-6 md:grid-cols-3">
            <div class="rounded-2xl border border-white/70 bg-white/80 p-4">
                <h3 class="text-lg font-semibold text-slate-700">理解需求</h3>
                <p class="text-sm text-gray-600">locate + graph 明确需求对应的文件与模块。</p>
            </div>
            <div class="rounded-2xl border border-white/70 bg-white/80 p-4">
                <h3 class="text-lg font-semibold text-slate-700">收集证据</h3>
                <p class="text-sm text-gray-600">read + search + retrieve 跨模态抓取证据。</p>
            </div>
            <div class="rounded-2xl border border-white/70 bg-white/80 p-4">
                <h3 class="text-lg font-semibold text-slate-700">给出判定</h3>
                <p class="text-sm text-gray-600">ask 模块输出判定并可追溯证据。</p>
            </div>
        </div>
    </div>

    <div class="card">
        <h2>消融发现：哪些模块更关键</h2>
        <p>论文在消融实验中发现，部分模块组合效果最好，说明评测代理对“高质量事实证据”非常敏感。</p>
        <div class="note-box text-sm mt-4">
            <p><strong>有效组合：</strong>graph + locate + read + retrieve + ask。</p>
            <p><strong>重要结论：</strong>memory 可能带来连锁错误；planning 目前不稳定，需要更强的策略设计。</p>
        </div>
        <figure class="mt-6 bg-white/70 border border-white/70 rounded-2xl p-4">
            <svg viewBox="0 0 860 240" role="img" aria-label="Ablation highlights" class="w-full">
                <rect x="24" y="24" width="812" height="192" rx="18" fill="#f8fafc" stroke="#e2e8f0" />
                <text x="60" y="58" font-size="12" fill="#64748b">消融趋势：高质量证据模块更关键</text>
                <rect x="80" y="110" width="140" height="30" rx="8" fill="#e2e8f0" />
                <rect x="80" y="90" width="140" height="50" rx="8" fill="#94a3b8" />
                <text x="150" y="170" text-anchor="middle" font-size="11" fill="#64748b">无 locate/read</text>

                <rect x="280" y="100" width="160" height="40" rx="8" fill="#e2e8f0" />
                <rect x="280" y="70" width="160" height="70" rx="8" fill="#34d399" />
                <text x="360" y="170" text-anchor="middle" font-size="11" fill="#64748b">含 locate/read</text>

                <rect x="500" y="90" width="160" height="50" rx="8" fill="#e2e8f0" />
                <rect x="500" y="60" width="160" height="80" rx="8" fill="#22c55e" />
                <text x="580" y="170" text-anchor="middle" font-size="11" fill="#64748b">含 retrieve</text>
            </svg>
            <figcaption class="text-sm text-gray-500 mt-3">读得到证据，评测才稳定；缺失关键模块会明显掉分。</figcaption>
        </figure>
    </div>

    <div class="card">
        <h2>落地启示：如何构建可复用评测代理</h2>
        <ul class="list-disc pl-6">
            <li><strong>需求必须可验证：</strong>每条需求都要能被证据支持或否定。</li>
            <li><strong>证据链必须明确：</strong>避免“凭感觉判定”。</li>
            <li><strong>控制记忆污染：</strong>历史错误会累积放大，需要可回滚机制。</li>
            <li><strong>把过程信号变成奖励：</strong>为代理系统自我改进提供路径。</li>
        </ul>
        <div class="note-box text-sm mt-4">
            <p><strong>一句话总结：</strong>Agent-as-a-Judge 让评测从“终局检查”升级为“过程反馈引擎”。</p>
        </div>
    </div>
</BaseLayout>
